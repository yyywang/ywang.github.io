{"name":"小程序","slug":"小程序","count":1,"postlist":[{"title":"小程序——this","slug":"小程序-this","date":"2018-12-08T08:36:42.000Z","updated":"2018-12-13T09:58:05.404Z","comments":true,"path":"api/articles/小程序-this.json","excerpt":"","keywords":null,"cover":null,"content":"<hr>\n<p>本地选择一图片，并设置为头像<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bindViewTap: function() &#123;</span><br><span class=\"line\">      wx.chooseImage(&#123; //从本地相册选择图片API</span><br><span class=\"line\">          success: function(res) &#123;</span><br><span class=\"line\">              const tempFilePaths = res.tempFilePaths</span><br><span class=\"line\">              console.log(tempFilePaths)</span><br><span class=\"line\">              this.setData(&#123;avatarUrl: tempFilePaths[0]&#125;)//设置为头像</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">  &#125;,</span><br></pre></td></tr></table></figure></p>\n<p>报错：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">Cannot read property &apos;setData&apos; of null;</span><br><span class=\"line\">at pages/index/index bindViewTap function;</span><br><span class=\"line\">at api chooseImage success callback function</span><br><span class=\"line\">TypeError: Cannot read property &apos;setData&apos; of null</span><br></pre></td></tr></table></figure></p>\n<hr>\n<p>chooseImage success回调函数不能读取null的setData属性？？？<br>劳资不是用的this吗？怎么会是null？<br>来先看一下this的含义：<strong>指向当前对象</strong>。<br>当前对象…当前对…当前…<br>当前对象，不能访问包含此对象的对象！</p>\n<hr>\n<p>来看当前代表哪个对象<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wx.chooseImage(&#123; //从本地相册选择图片API</span><br><span class=\"line\">          success: function(res) &#123;</span><br><span class=\"line\">              const tempFilePaths = res.tempFilePaths</span><br><span class=\"line\">              console.log(tempFilePaths)</span><br><span class=\"line\">              this.setData(&#123;avatarUrl: tempFilePaths[0]&#125;)//设置为头像</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">      &#125;)</span><br></pre></td></tr></table></figure></p>\n<p>注意细节：<code>wx.chooseImage()</code><br>好了，当前对象是：<code>wx</code><br><code>wx</code>里没有<code>setData</code>这个属性，所以报以上错误。<br>我们要设置的是<code>Page</code>的<code>data</code>中的值，而<code>Page</code>是包含<code>wx</code>的对象，所以要在<code>Page</code>和<code>wx</code>两对象间“搭桥”。<code>var that = this</code></p>\n<hr>\n<p>正确代码：<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">bindViewTap: function() &#123;</span><br><span class=\"line\">        var that = this</span><br><span class=\"line\">        wx.chooseImage(&#123; //从本地相册选择图片API</span><br><span class=\"line\">            success: function(res) &#123;</span><br><span class=\"line\">                const tempFilePaths = res.tempFilePaths</span><br><span class=\"line\">                console.log(tempFilePaths)</span><br><span class=\"line\">                that.setData(&#123;</span><br><span class=\"line\">                    avatarUrl: tempFilePaths[0]</span><br><span class=\"line\">                &#125;) //设置为头像</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    &#125;,</span><br></pre></td></tr></table></figure></p>\n","text":"本地选择一图片，并设置为头像<br>1<br>2<br>3<br>4<br>5<br>6<br>7<br>8<br>9<br>bindViewTap: function() &#123;<br>      wx.chooseImage(&#123; //从本地相册选择图片API<","link":"","raw":null,"photos":[],"categories":[],"tags":[{"name":"小程序","slug":"小程序","count":1,"path":"api/tags/小程序.json"}]}]}